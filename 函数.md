## 6-1 各种各样的函数
### 函数的种类
- 算术函数(用来进行数值计算的函数)
- 字符串函数(用来进行字符串操作的函数) 
- 日期函数(用来进行日期操作的函数)
- 转换函数(用来转换数据类型和值的函数
- 聚合函数(用来进行数据聚合的函数)

### 算数函数
**首先创建一张示例用表 (SampleMath)**

	- DDL:创建表
	CREATE TABLE SampleMath
	(m NUMERIC (10,3),
	n INTEGER,
	p INTEGER);

	-- DML:插入数据
	BEGIN TRANSACTION; 
	
	INSERT INTO SampleMath(m, n, p) VALUES (500, 0,  NULL); 
	INSERT INTO SampleMath(m, n, p) VALUES (-180, 0, NULL); 
	INSERT INTO SampleMath(m, n, p) VALUES (NULL, NULL, NULL); 		
	INSERT INTO SampleMath(m, n, p) VALUES (NULL, 7, 3);
	INSERT INTO SampleMath(m, n, p) VALUES (NULL, 5, 2);
	INSERT INTO SampleMath(m, n, p) VALUES (NULL, 4, NULL);
	INSERT INTO SampleMath(m, n, p) VALUES (8, NULL, 3);
	INSERT INTO SampleMath(m, n, p) VALUES (2.27, 1, NULL);
	INSERT INTO SampleMath(m, n, p) VALUES (5.555,2, NULL);
	INSERT INTO SampleMath(m, n, p) VALUES (NULL, 1, NULL); 
	INSERT INTO SampleMath(m, n, p) VALUES (8.76, NULL, NULL);
	
	COMMIT;
	
**确认表中内容**
	
	SELECT * FROM SampleMath;
		
 函数类型  | 函数形式  | 备注
 ---- | ----- | ------  
 绝对值  | ABS（数值） | 函数的参数为NULL时，结果也是NULL 
 求余  | MOD（被除数，除数）|只能对整数类型的列使用MOD函数，主流的DBMS都支持，只有SQL Server不支持
 四舍五入  | ROUND（对象数值，保留小数的位数）
 
**计算绝对值** 
	 
	 SELECT m,
		ABS(m) AS abs_col
	   FROM SampleMath;
	   
![6-2 计算绝对值](https://github.com/AliciaZhang-R/pictures/blob/main/6-2.png) 

**计算余数**
	 
	 SELECT n, p,
		MOD(n, p) AS mod_col
	   FROM SampleMath;
	   
![6-4 计算余数](https://github.com/AliciaZhang-R/pictures/blob/main/6-3.png) 	

note：SQL Server使用特殊的运算符(函数)“%”来计算余数：
	 
	 SELECT n, p,
		n % p AS mod_col
	   FROM SampleMath;

**四舍五入**
	
	SELECT m, n,
		ROUND(m, n) AS round_col
	   FROM SampleMath;
	   
![6-4 四舍五入](https://github.com/AliciaZhang-R/pictures/blob/main/6-4.png) 


### 字符串函数
**首先创建一张表(SampleStr)**

	-- DDL:创建表
	CREATE TABLE SampleStr
	(str1 VARCHAR(40),
	 str2 VARCHAR(40), 
	 str3 VARCHAR(40);
	 
	-- DML:插入数据
	BEGIN TRANSACTION; 
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('opx', 'rt', NULL);
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('abc', 'def', NULL);
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('山田', '太郎', '是我');
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('aaa' NULL ,NULL);
	INSERT INTO SampleStr (str1, str2, str3) VALUES (NULL 'xyz',NULL);
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('@!#$%' NULL ,NULL);
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('ABC' NULL ,NULL);
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('aBC' NULL ,NULL);
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('abc太郎' 'abc' ,'ABC');
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('abcdefabc' 'abc' ,'ABC');
	INSERT INTO SampleStr (str1, str2, str3) VALUES ('micmic' 'i' ,'I');
        
	COMMIT;
 
 	其中，DML语句在 MySQL 中执行时，需要将‘BEGIN TRANSACTION’更改为“START TRANSACTION;”。
	在 Oracle 和 DB2 中执行时，无需插入‘BEGIN TRANSACTION’。
 
 **确认表中内容**
	
	SELECT * FROM SampleStr;
	
![6-5 SampleStr](https://github.com/AliciaZhang-R/pictures/blob/main/6-5.png) 
 
 
 函数类型  | 函数形式  | 备注
 ---- | ----- | ------  
 拼接| 字符串1 || 字符串2 ||…	| 字符串包含NULL时，结果也是NULL
 字符串长度  | LENGTH（字符串）| 汉字这样的全角字符会占用 2 个以上的字节,无法在 SQLServer中使用
 小写转换  | LOWER（字符串）| 只能针对英文字母使用
 大写转换  | UPPER（字符串）|
 替换字符串  | REPLACE（对象字符串，替换前的字符串，替换后的字符串
 截取字符串  | SUBSTRING（对象字符串 FROM 起始位置 FOR 截取的字符数） |只有 PostgreSQL 和 MySQL 支持该语法
 
**拼接字符串**
	
	SELECT str1, str2,
	       str1 || str2 AS str_concat
	  FROM SampleStr;
	  
 ![6-6 拼接字符串](https://github.com/AliciaZhang-R/pictures/blob/main/6-6.png) 
 
note1：|| 函数在 SQL Server 和 MySQL 中无法使用。

note2：SQL Server使用“+”运算符(函数)来连接字符串A。
 
	SELECT str1, str2, str3,
		str1 + str2 + str3 AS str_concat
	  FROM SampleStr;
	  
note3：MySQL使用CONCAT函数来完成字符串的拼接。
	
	SELECT str1, str2, str3,
		CONCAT(str1, str2, str3) AS str_concat
	  FROM SampleStr;
 
 
 **计算字符串长度**
 
	SELECT str1,
		LENGTH(str1) AS len_str
          FROM SampleStr;

 ![6-8 计算字符串长度](https://github.com/AliciaZhang-R/pictures/blob/main/6-8.png)  
 
note:SQL Server使用LEN函数来计算字符串的长度

	SELECT str1,
		LEN(str1) AS len_str
	  FROM SampleStr;
 
 **大小写转换**
 
	 SELECT str1,
		LOWER(str1) AS low_str
 	   FROM SampleStr
	 WHERE str1 IN ('ABC', 'aBC', 'abc', '山田');
  
 **替换字符串**

	SELECT str1, str2, str3,
		REPLACE(str1, str2, str3) AS rep_str
	  FROM SampleStr;
 
 ![6-10 替换字符串](https://github.com/AliciaZhang-R/pictures/blob/main/6-10.png) 
 
 
  **截取字符串**
  
	SELECT str1,
		SUBSTRING(str1 FROM 3 FOR 2) AS sub_str
          FROM SampleStr;

 ![6-11 截取字符串](https://github.com/AliciaZhang-R/pictures/blob/main/6-11.png) 



### 日期函数

 函数类型  | 函数形式  | 备注
 ---- | ----- | ------  
 当前日期 |	CURRENT——DATE  |返回SQL执行的日期
 当前时间 |	CURRENT——TIME  |返回SQL执行的时间
 当前日期和时间 | CURRENR——TIMESTAMP | 同时得到当前的日期和时间
 截取日期元素	| EXTRACT(日期元素 FROM 日期)	| 该函数的返回值并不是日期类型而是数值类型,SQL Server无法使用该函数
 
 **获得当前日期**
 	
	SELECT CURRENT_DATE;
 
 ![6-13 获得当前日期](https://github.com/AliciaZhang-R/pictures/blob/main/6-13.png) 
 
 note: SQL Server使用CAST函数将CURRENT_TIMESTAMP转换为日期类型
 
 	SELECT CAST(CURRENT_TIMESTAMP AS DATE) AS CUR_DATE;
	
	
 **取得当前时间**
 
 	SELECT CURRENT_TIME;
	
 ![6-14 取得当前时间](https://github.com/AliciaZhang-R/pictures/blob/main/6-14.png) 
 
 note: SQL Server使用CAST函数将CURRENT_TIMESTAMP转换为时间类型 
	
	SELECT CAST(CURRENT_TIMESTAMP AS TIME) AS CUR_TIME;

 
 **取得当前日期和时间**
 
 	SELECT CURRENT_TIMESTAMP;
 
 ![6-15 取得当前日期和时间](https://github.com/AliciaZhang-R/pictures/blob/main/6-15.png)
 
 
 **截取日期元素**
 
 	SELECT CURRENT_TIMESTAMP,
		EXTRACT(YEAR FROM CURRENT_TIMESTAMP) AS year, 
		EXTRACT(MONTH FROM CURRENT_TIMESTAMP) AS month, 
		EXTRACT(DAY FROM CURRENT_TIMESTAMP) AS day, 
		EXTRACT(HOUR FROM CURRENT_TIMESTAMP) AS hour, 
		EXTRACT(MINUTE FROM CURRENT_TIMESTAMP) AS minute, 
		EXTRACT(SECOND FROM CURRENT_TIMESTAMP) AS second;
         
 ![6-16 截取日期元素](https://github.com/AliciaZhang-R/pictures/blob/main/6-16.png) 

note: SQL Server使用如下的DATEPART函数
	
	SELECT CURRENT_TIMESTAMP,
		DATEPART(YEAR , CURRENT_TIMESTAMP) AS year, 
		DATEPART(MONTH , CURRENT_TIMESTAMP) AS month, 
		DATEPART(DAY , CURRENT_TIMESTAMP) AS day, 
		DATEPART(HOUR , CURRENT_TIMESTAMP) AS hour,
		DATEPART(MINUTE , CURRENT_TIMESTAMP) AS minute, 
		DATEPART(SECOND , CURRENT_TIMESTAMP) AS second;
 
 ### 转换函数
之所以需要进行类型转换，是因为可能会插入与表中数据类型不匹配的数据，或者在进行运算时由于数据类型不一致发生了错误，又或者是进行自动类型转换会造成处理速度低下。这些时候都需要事前进行数据类型转换.

 函数类型  | 函数形式  | 备注
 ---- | ----- | ------  
 类型转换 | CAST(转换前的值 AS 目标数据类型) | 数据类型：INTEGER、DATE
 NULL值转换 |	COALESCE(数据1，数据2，…) | 返回可变参数中左侧开始第1个不是NULL的值，使包含NULL的列转换为其他值
 
 **将字符串类型转换为数值类型**
MySQL

	SELECT CAST('0001' AS SIGNED INTEGER) AS int_col;

SQL Server/Postgres SQL

	SELECT CAST('0001' AS INTEGER) AS int_col;

 ![6-17 将字符串类型转换为数值类型](https://github.com/AliciaZhang-R/pictures/blob/main/6-17.png) 	     
 **将字符串类型转换为日期类型**
 
MySQL

	SELECT CAST('2009-12-14' AS DATE) AS date_col;
	  FROM DUAL;

SQL Server/Postgres SQL

	SELECT CAST('2009-12-14' AS DATE) AS date_col;

![6-18 将字符串类型转换为日期类型](https://github.com/AliciaZhang-R/pictures/blob/main/6-18.png) 
 
 **将 NULL 转换为其他值**
 SQL Server PostgreSQL MySQL
	
	SELECT COALESCE(NULL, 1)
		COALESCE(NULL, 'test', NULL)
		COALESCE(NULL, NULL, '2009-11-01')
![6-19 将 NULL 转换为其他值](https://github.com/AliciaZhang-R/pictures/blob/main/6-19.png) 

使用 SampleStr 表中的列作为例子

	SELECT COALESCE(str2, 'NULL') 
	  FROM SampleStr;

 ![6-20 将 NULL 转换为其他值](https://github.com/AliciaZhang-R/pictures/blob/main/6-20.png) 
